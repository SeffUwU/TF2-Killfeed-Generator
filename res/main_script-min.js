const[BLUE_TEAM_CLR,RED_TEAM_CLR]=["#557C83","#A3574A"];let df;function get_icon_list(){var t=Object.keys(iconList).length;console.log(`Icon amount: ${t}`);for(var e=1;e<t+1;e++){var a=Object.keys(iconList[`${e}`]),i=iconList[e][a];$(".killicon-container").append(`<div class='list-item ${i}' data-fname="${a}">\n        <img class="selectable-img " src="icons_sorted/${a}" data-fname="${a}" alt='${a.toString().slice(0,-4).replace("_"," ")}'>\n       </div>`)}}async function color_switch(){df.attr("data-colors",0==df.attr("data-colors")?1:0);const[t,e]=returnTeamColorTuple();$(".clr-show-l").css("background",t),$(".clr-show-r").css("background",e),draw_kill()}function returnTeamColorTuple(){return console.log("teamKill",df.attr("data-teamkill")),console.log("colors",df.attr("data-colors")),1==df.attr("data-teamkill")?0==df.attr("data-colors")?[RED_TEAM_CLR,RED_TEAM_CLR]:[BLUE_TEAM_CLR,BLUE_TEAM_CLR]:0==df.attr("data-colors")?[RED_TEAM_CLR,BLUE_TEAM_CLR]:[BLUE_TEAM_CLR,RED_TEAM_CLR]}function draw_kill(t){if(!df)return;const e=new Image,a=df.attr("data-is-ks")>0,i=new Image;i.origin="anonymous";const o=new Image;o.origin="anonymous";const s=$("#KILLER").val(),l=$("#VICTIM").val(),n=df.attr("data-icon-name"),c=$("#transparent_bg").prop("checked")&&!$("#is_init").prop("checked")?"c8":"",d=$("#is_init").prop("checked")?"#E2CDB2":"#202020"+c,[r,h]=returnTeamColorTuple(),f=document.getElementById("display-feed"),[m,g]=[f.width,f.height];1==a&&(e.src=$("#is_init").prop("checked")?"icons_sorted/Killstreak_Icon.png":"icons_sorted/Killstreak_Icon02.png"),o.src="icons_sorted/"+n;const p=f.getContext("2d");p.imageSmoothingEnabled=!0,o.onload=function(){p.clearRect(0,0,m,g),p.font="bold 125% Verdana";const o=1.52,n=$("#is_drawIcon").prop("checked")?this.width*o:0,c=$("#is_init").prop("checked")?"#3e3923":"#F1E9CB",_=df.attr("data-is-ks"),u={domination:"is DOMINATING",custom:$("#custom_special").val(),fallDamage:"fell to a clumsy, painful death"};let k=1==t?p.measureText(u.domination).width:2==t?p.measureText(u.custom).width:3==t?p.measureText(u.fallDamage).width:0;k+=n,p.font="bold 20px Verdana",ks_offset=1==a?p.measureText(_).width+30:0,p.font="bold 125% Verdana";let w=112+p.measureText(s).width+k+p.measureText(l).width+ks_offset;if(3==t){w-=p.measureText(u.fallDamage).width-25}$("#save").attr("data-img-width",Math.ceil(w+1));const T=f.width/2-w/2;p.roundRect(T,20,T+w,g,6),p.strokeStyle="#000",p.fillStyle=d,p.fill(),3!=t&&(p.fillStyle=r,p.fillText(s,T+38,58));let b=T+(ks_offset+($("#is_drawIcon").prop("checked")?50:40))+p.measureText(s).width;3==t&&(b-=p.measureText(u.fallDamage).width-40);const C=g/2-this.height/2+9;if(a>0){p.font="bold 20px Verdana",p.fillStyle=$("#is_init").prop("checked")?"#202020":"#f1e9cb",p.fillText(_,b-ks_offset,58);const t=p.measureText(_).width;p.drawImage(e,t+b-ks_offset,g/2,e.height/1.7,e.width/1.7),p.font="bold 125% Verdana"}if("0"!=df.attr("data-special-bg")){const t=2.3200000000000003;p.globalAlpha=.85,p.globalCompositeOperation="source-atop",p.drawImage(i,b+n/2-i.width*t/2,g/6,i.width*t,i.height*t),p.globalAlpha=1,p.globalCompositeOperation="source-over"}if($("#is_drawIcon").prop("checked")){const e=this.width,a=this.height;if(p.drawImage(this,b,C-a/4,e*o,a*o),!$("#is_init").prop("checked")||1==t){let i=1==t?masked_image(this,245,229,193,255,10,e,a,o):masked_image(this,64,60,36,255,55,e,a,o);const s=document.createElement("canvas"),l=s.getContext("2d");s.width=m,s.height=g,l.drawImage(this,b,C-a/4,e*o,a*o),l.globalCompositeOperation="source-in",l.drawImage(i,b,C-a/4),p.drawImage(s,0,0),s.delete}}1==t?(p.fillStyle=c,p.fillText(u.domination,b+n+14,58)):2==t?(p.fillStyle=c,p.fillText(u.custom,b+n+14,58)):3==t&&(p.fillStyle=c,p.fillText(u.fallDamage,b+n+14,58)),p.fillStyle=h,p.fillText(l,b+k+(t?24:14),58)},i.src=$("1"==df.attr("data-special-bg")?"img[data-fname='Killicon_crit.png']":"img[data-fname='Killicon_australium.png']").attr("src"),o.src=1==t?"icons_sorted/Killicon_domination.png":3==t?"icons_sorted/Killicon_skull.png":$(`img[data-fname='${n}']`).attr("src")}function save(){const t=$("#save").attr("data-img-width"),e=document.getElementById("display-feed"),a=e.width/2-t/2,i=document.createElement("canvas");i.width=t,i.height=80,tctx=i.getContext("2d"),tctx.drawImage(e,a,0,t,80,0,-10,t,80);const o=document.createElement("a");o.download="killfeed_generated.png",o.href=i.toDataURL(),o.click(),o.delete}function masked_image(t,e,a,i,o,s,l,n,c=1){let d=document.createElement("canvas");d.width=l*c,d.height=n*c,ctx=d.getContext("2d"),ctx.drawImage(t,0,0,l*c,n*c);for(var r=ctx.getImageData(0,0,d.width,d.height),h=r.data,f=0;f<h.length;f+=4){var m=h[f+0]>e-s&&h[f+0]<e+s&&h[f+1]>a-s&&h[f+1]<a+s&&h[f+2]>i-s&&h[f+2]<i+s&&h[f+3]>0;h[f+0]=m?241:0,h[f+1]=m?233:0,h[f+2]=m?203:0,h[f+3]=m?255:0}return ctx.putImageData(r,0,0),d}$(document).ready((function(){let t=[];$(".sortable").on("click",(function(){const e=$(this).attr("data-tags");$(".list-item").css("display",""),"off"==$(this).attr("data-sort")?(t=t.filter((t=>t!==`.${e}`)),$(this).attr("data-sort","on")):(t.push(`.${e}`),$(this).attr("data-sort","off")),$(t.join(",")).css("display","none")})),$("#deselect-all").click((function(){const t=$(".sortable");t.attr("data-sort","on"),t.click()})),df=$("#display-feed"),$("#is_killstreak").on("input",(()=>{let t=$("#is_killstreak").val();$("#display-feed").attr("data-is-ks",t>=0?t:0)})),$("#is_crit").change((function(){if(this.checked)return df.attr("data-special-bg",1),$("#is_aussie").prop("checked",!1);df.attr("data-special-bg",0)})),$("#is_aussie").change((function(){if(this.checked)return df.attr("data-special-bg",2),$("#is_crit").prop("checked",!1);df.attr("data-special-bg",0)})),$("#is_teamkill").change((function(){if(this.checked)return df.attr("data-teamkill",1),color_switch(),$("#is_crit").prop("checked",!1);df.attr("data-teamkill",0),color_switch()})),$(document).on("click",".list-item",(function(){const t=$(this).attr("data-fname");$(".list-item").removeClass("selected"),$(this).addClass("selected"),$("#display-feed").attr("data-icon-name",`${t}`),draw_kill()})),$(".name-input").keypress((function(t){10!=t.keyCode&&13!=t.keyCode||!t.shiftKey?10!=t.keyCode&&13!=t.keyCode||$("#kill_btn").click():$("#kill_btn_dom").click()})),$(".option-checkbox").change((function(){$("#is_init").prop("checked")?$("#transparent_bg").attr("disabled",!0):$("#transparent_bg").attr("disabled",!1),draw_kill()})),$("#KILLER, #VICTIM, #is_killstreak").on("input",(()=>{$("#updateOnChange").prop("checked")&&draw_kill()})),draw_kill()})),CanvasRenderingContext2D.prototype.roundRect=function(t,e,a,i,o){var s=Math.PI/180;a-t-2*o<0&&(o=(a-t)/2),i-e-2*o<0&&(o=(i-e)/2),this.beginPath(),this.moveTo(t+o,e),this.lineTo(a-o,e),this.arc(a-o,e+o,o,270*s,360*s,!1),this.lineTo(a,i-o),this.arc(a-o,i-o,o,0*s,90*s,!1),this.lineTo(t+o,i),this.arc(t+o,i-o,o,90*s,180*s,!1),this.lineTo(t,e+o),this.arc(t+o,e+o,o,180*s,270*s,!1),this.closePath()};