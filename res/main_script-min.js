let df;function get_icon_list(){var t=Object.keys(iconlist).length;console.log(`Icon amount:${t}`);for(var e=1;e<t+1;e++){var a=Object.keys(iconlist[`${e}`]),i=iconlist[`${e}`][`${a}`];$(".killicon-container").append(`<div class='list-item ${i}' data-fname="${a}"> <img class="selectable-img " src="icons_sorted/${a}" data-fname="${a}" alt='`+a.toString().slice(0,-4).replace("_"," ")+"'> </div>")}}async function color_switch(){0==df.attr("data-colors")?(df.attr("data-colors",1),$(".clr-show-l").css("background","#004bff"),$(".clr-show-r").css("background","#c40000")):(df.attr("data-colors",0),$(".clr-show-l").css("background","#c40000"),$(".clr-show-r").css("background","#004bff")),draw_kill()}function draw_kill(t){let e=new Image,a=df.attr("data-is-ks")>0,i=new Image;i.origin="anonymous";let l=new Image;l.origin="anonymous";let s=$("#KILLER").val(),d=$("#VICTIM").val(),o=df.attr("data-icon-name"),r=$("#transparent_bg").prop("checked")&&!$("#is_init").prop("checked")?"c8":"",c=$("#is_init").prop("checked")?"#F1E9CB":"#202020"+r,n=0==df.attr("data-colors")?"#A3574A":"#557C83",h=0==df.attr("data-colors")?"#557C83":"#A3574A",f=document.getElementById("display-feed"),[g,p]=[f.width,f.height];!0==a&&(e.src=$("#is_init").prop("checked")?"icons_sorted/Killstreak_Icon.png":"icons_sorted/Killstreak_Icon02.png"),l.src="icons_sorted/"+o;let m=f.getContext("2d");m.imageSmoothingEnabled=!0,l.onload=function(){m.clearRect(0,0,g,p),m.font="bold 125% Verdana";let l=$("#is_drawIcon").prop("checked")?1.52*this.width:0,o=$("#is_init").prop("checked")?"#3e3923":"#F1E9CB",r=df.attr("data-is-ks"),k=0+(1==t?m.measureText("is DOMINATING").width:2==t?m.measureText($("#custom_special").val()).width:0);k+=l,m.font="bold 20px Verdana",ks_offset=!0==a?m.measureText(r).width+30:0,m.font="bold 125% Verdana";let _=112+m.measureText(s).width+k+m.measureText(d).width+ks_offset;$("#save").attr("data-img-width",Math.ceil(_+1));let u=f.width/2-_/2;m.roundRect(u,20,u+_,p,6),m.strokeStyle="#000",m.fillStyle=c,m.fill(),m.fillStyle=n,m.fillText(s,u+38,58);let w=ks_offset+($("#is_drawIcon").prop("checked")?50:40),b=u+w+m.measureText(s).width,y=p/2-this.height/2+9;if(a>0){m.font="bold 20px Verdana",m.fillStyle=$("#is_init").prop("checked")?"#202020":"#f1e9cb",m.fillText(r,b-ks_offset,58);let I=m.measureText(r).width;m.drawImage(e,I+b-ks_offset,p/2,e.height/1.7,e.width/1.7),m.font="bold 125% Verdana"}if("0"!=df.attr("data-special-bg")){let v=1.52+.8;m.globalAlpha=.85,m.globalCompositeOperation="source-atop",m.drawImage(i,b+l/2-i.width*v/2,p/6,i.width*v,i.height*v),m.globalAlpha=1,m.globalCompositeOperation="source-over"}if($("#is_drawIcon").prop("checked")){let T=this.width,C=this.height;if(m.drawImage(this,b,y-C/4,1.52*T,1.52*C),!$("#is_init").prop("checked")||1==t){let x=1==t?masked_image(this,245,229,193,255,10,T,C,1.52):masked_image(this,64,60,36,255,55,T,C,1.52),E=document.createElement("canvas"),S=E.getContext("2d");E.width=g,E.height=p,S.drawImage(this,b,y-C/4,1.52*T,1.52*C),S.globalCompositeOperation="source-in",S.drawImage(x,b,y-C/4),m.drawImage(E,0,0),E.delete}}1==t?(m.fillStyle=o,m.fillText("is DOMINATING",b+l+14,58)):2==t&&(m.fillStyle=o,m.fillText($("#custom_special").val(),b+l+14,58)),m.fillStyle=h,m.fillText(d,b+k+(t?24:14),58)},i.src=$("1"==df.attr("data-special-bg")?"img[data-fname='Killicon_crit.png']":"img[data-fname='Killicon_australium.png']").attr("src"),l.src=1==t?"icons_sorted/Killicon_domination.png":$(`img[data-fname='${o}']`).attr("src")}function save(){let t=$("#save").attr("data-img-width"),e=document.getElementById("display-feed"),a=e.width/2-t/2,i=document.createElement("canvas");i.width=t,i.height=80,(tctx=i.getContext("2d")).drawImage(e,a,0,t,80,0,-10,t,80);let l=document.createElement("a");l.download="killfeed_generated.png",l.href=i.toDataURL(),l.click(),l.delete}function masked_image(t,e,a,i,l,s,d,o,r=1){let c=document.createElement("canvas");c.width=d*r,c.height=o*r,(ctx=c.getContext("2d")).drawImage(t,0,0,d*r,o*r);for(var n=ctx.getImageData(0,0,c.width,c.height),h=n.data,f=0;f<h.length;f+=4){var g=h[f+0]>e-s&&h[f+0]<e+s&&h[f+1]>a-s&&h[f+1]<a+s&&h[f+2]>i-s&&h[f+2]<i+s&&h[f+3]>0;h[f+0]=g?241:0,h[f+1]=g?233:0,h[f+2]=g?203:0,h[f+3]=g?255:0}return ctx.putImageData(n,0,0),c}$(document).ready(function(){let t=[];$(".sortable").on("click",function(){let e=$(this).attr("data-tags");$(".list-item").css("display",""),"off"==$(this).attr("data-sort")?(t=t.filter(t=>t!==`.${e}`),$(this).attr("data-sort","on")):(t.push(`.${e}`),$(this).attr("data-sort","off")),$(t.join(",")).css("display","none")}),$("#deselect-all").click(function(){let t=$(".sortable");t.attr("data-sort","on"),t.click()}),df=$("#display-feed"),$("#is_killstreak").on("input",()=>{let t=$("#is_killstreak").val();$("#display-feed").attr("data-is-ks",t>=0?t:0)}),$("#is_crit").change(function(){this.checked?(df.attr("data-special-bg",1),$("#is_aussie").prop("checked",!1)):df.attr("data-special-bg",0)}),$("#is_aussie").change(function(){this.checked?(df.attr("data-special-bg",2),$("#is_crit").prop("checked",!1)):df.attr("data-special-bg",0)}),$(".name-input").keypress(function(t){(10==t.keyCode||13==t.keyCode)&&t.shiftKey?$("#kill_btn_dom").click():(10==t.keyCode||13==t.keyCode)&&$("#kill_btn").click()}),$(".option-checkbox").change(function(){$("#is_init").prop("checked")?$("#transparent_bg").attr("disabled",!0):$("#transparent_bg").attr("disabled",!1),draw_kill()}),$("#KILLER, #VICTIM, #is_killstreak").on("input",()=>{$("#updateOnChange").prop("checked")&&draw_kill()})}),$(document).on("click",".list-item",function(){let t=$(this).attr("data-fname");$(".list-item").removeClass("selected"),$(this).addClass("selected"),$("#display-feed").attr("data-icon-name",`${t}`),draw_kill()}),CanvasRenderingContext2D.prototype.roundRect=function(t,e,a,i,l){var s=Math.PI/180;a-t-2*l<0&&(l=(a-t)/2),i-e-2*l<0&&(l=(i-e)/2),this.beginPath(),this.moveTo(t+l,e),this.lineTo(a-l,e),this.arc(a-l,e+l,l,270*s,360*s,!1),this.lineTo(a,i-l),this.arc(a-l,i-l,l,0*s,90*s,!1),this.lineTo(t+l,i),this.arc(t+l,i-l,l,90*s,180*s,!1),this.lineTo(t,e+l),this.arc(t+l,e+l,l,180*s,270*s,!1),this.closePath()};