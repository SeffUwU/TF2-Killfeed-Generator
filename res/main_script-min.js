let df;function get_icon_list(){var c=Object.keys(iconlist).length;console.log(`Icon amount:${c}`);for(var b=1;b<c+1;b++){var a=Object.keys(iconlist[`${b}`]),d=iconlist[`${b}`][`${a}`];$(".killicon-container").append(`<div class='list-item ${d}' data-fname="${a}"> <img class="selectable-img " src="icons_sorted/${a}" data-fname="${a}" alt='`+a.toString().slice(0,-4).replace("_"," ")+"'> </div>")}}async function color_switch(){0==df.attr("data-colors")?(df.attr("data-colors",1),$(".clr-show-l").css("background","#004bff"),$(".clr-show-r").css("background","#c40000")):(df.attr("data-colors",0),$(".clr-show-l").css("background","#c40000"),$(".clr-show-r").css("background","#004bff")),draw_kill()}function draw_kill(e){let f=new Image,g=df.attr("data-is-ks")>0,c=new Image;c.origin="anonymous";let a=new Image;a.origin="anonymous";let i=$("#KILLER").val(),j=$("#VICTIM").val(),d=df.attr("data-icon-name"),k=$("#is_init").prop("checked")?"#F1E9CB":"#202020",l=0==df.attr("data-colors")?"#A3574A":"#557C83",m=0==df.attr("data-colors")?"#557C83":"#A3574A",b=document.getElementById("display-feed"),[n,o]=[b.width,b.height];!0==g&&(f.src=$("#is_init").prop("checked")?"icons_sorted/Killstreak_Icon.png":"icons_sorted/Killstreak_Icon02.png"),a.src="icons_sorted/"+d;let h=b.getContext("2d");h.imageSmoothingEnabled=!0,a.onload=function(){h.clearRect(0,0,n,o),h.font="bold 125% Verdana";let d=1.52,r=$("#is_drawIcon").prop("checked")?this.width*d:0,A=$("#is_init").prop("checked")?"#3e3923":"#F1E9CB",u=df.attr("data-is-ks"),v=0+(1==e?h.measureText("is DOMINATING").width:2==e?h.measureText($("#custom_special").val()).width:0);v+=r,h.font="bold 20px Verdana",ks_offset=!0==g?h.measureText(u).width+30:0,h.font="bold 125% Verdana";let w=112+h.measureText(i).width+v+h.measureText(j).width+ks_offset;$("#save").attr("data-img-width",Math.ceil(w+1));let s=b.width/2-w/2;h.roundRect(s,20,s+w,o,6),h.strokeStyle="#000",h.fillStyle=k,h.fill(),h.fillStyle=l,h.fillText(i,s+38,58);let B=ks_offset+($("#is_drawIcon").prop("checked")?50:40),a=s+B+h.measureText(i).width,x=o/2-this.height/2+9;if(g>0){h.font="bold 20px Verdana",h.fillStyle=$("#is_init").prop("checked")?"#202020":"#f1e9cb",h.fillText(u,a-ks_offset,58);let C=h.measureText(u).width;h.drawImage(f,C+a-ks_offset,o/2,f.height/1.7,f.width/1.7),h.font="bold 125% Verdana"}if("0"!=df.attr("data-special-bg")){let y=d+.8;h.globalAlpha=.85,h.globalCompositeOperation="source-atop",h.drawImage(c,a+r/2-c.width*y/2,o/6,c.width*y,c.height*y),h.globalAlpha=1,h.globalCompositeOperation="source-over"}if($("#is_drawIcon").prop("checked")){let t=this.width,p=this.height;if(h.drawImage(this,a,x-p/4,t*d,p*d),!$("#is_init").prop("checked")||1==e){let D=1==e?masked_image(this,245,229,193,255,10,t,p,d):masked_image(this,64,60,36,255,55,t,p,d),q=document.createElement("canvas"),z=q.getContext("2d");q.width=n,q.height=o,z.drawImage(this,a,x-p/4,t*d,p*d),z.globalCompositeOperation="source-in",z.drawImage(D,a,x-p/4),h.drawImage(q,0,0),q.delete}}1==e?(h.fillStyle=A,h.fillText("is DOMINATING",a+r+14,58)):2==e&&(h.fillStyle=A,h.fillText($("#custom_special").val(),a+r+14,58)),h.fillStyle=m,h.fillText(j,a+v+(e?24:14),58)},c.src=$("1"==df.attr("data-special-bg")?"img[data-fname='Killicon_crit.png']":"img[data-fname='Killicon_australium.png']").attr("src"),a.src=1==e?"icons_sorted/Killicon_domination.png":$(`img[data-fname='${d}']`).attr("src")}function save(){let a=$("#save").attr("data-img-width"),d=document.getElementById("display-feed"),e=d.width/2-a/2,b=document.createElement("canvas");b.width=a,b.height=80,(tctx=b.getContext("2d")).drawImage(d,e,0,a,80,0,-10,a,80);let c=document.createElement("a");c.download="killfeed_generated.png",c.href=b.toDataURL(),c.click(),c.delete}function masked_image(m,g,h,i,n,c,j,k,e=1){let d=document.createElement("canvas");d.width=j*e,d.height=k*e,(ctx=d.getContext("2d")).drawImage(m,0,0,j*e,k*e);for(var l=ctx.getImageData(0,0,d.width,d.height),b=l.data,a=0;a<b.length;a+=4){var f=b[a+0]>g-c&&b[a+0]<g+c&&b[a+1]>h-c&&b[a+1]<h+c&&b[a+2]>i-c&&b[a+2]<i+c&&b[a+3]>0;b[a+0]=f?241:0,b[a+1]=f?233:0,b[a+2]=f?203:0,b[a+3]=f?255:0}return ctx.putImageData(l,0,0),d}$(document).ready(function(){let a=[];$(".sortable").on("click",function(){let b=$(this).attr("data-tags");$(".list-item").css("display",""),"off"==$(this).attr("data-sort")?(a=a.filter(a=>a!==`.${b}`),$(this).attr("data-sort","on")):(a.push(`.${b}`),$(this).attr("data-sort","off")),$(a.join(",")).css("display","none")}),$("#deselect-all").click(function(){let a=$(".sortable");a.attr("data-sort","on"),a.click()}),df=$("#display-feed"),$("#is_killstreak").on("input",()=>{let a=$("#is_killstreak").val();$("#display-feed").attr("data-is-ks",a>=0?a:0)}),$("#is_crit").change(function(){this.checked?(df.attr("data-special-bg",1),$("#is_aussie").prop("checked",!1)):df.attr("data-special-bg",0)}),$("#is_aussie").change(function(){this.checked?(df.attr("data-special-bg",2),$("#is_crit").prop("checked",!1)):df.attr("data-special-bg",0)}),$(".name-input").keypress(function(a){(10==a.keyCode||13==a.keyCode)&&a.shiftKey?$("#kill_btn_dom").click():(10==a.keyCode||13==a.keyCode)&&$("#kill_btn").click()}),$(".option-checkbox").change(function(){draw_kill()}),$("#KILLER, #VICTIM, #is_killstreak").on("input",()=>{$("#updateOnChange").prop("checked")&&draw_kill()})}),$(document).on("click",".list-item",function(){let a=$(this).attr("data-fname");$(".list-item").removeClass("selected"),$(this).addClass("selected"),$("#display-feed").attr("data-icon-name",`${a}`),draw_kill()}),CanvasRenderingContext2D.prototype.roundRect=function(c,d,e,f,a){var b=Math.PI/180;e-c-2*a<0&&(a=(e-c)/2),f-d-2*a<0&&(a=(f-d)/2),this.beginPath(),this.moveTo(c+a,d),this.lineTo(e-a,d),this.arc(e-a,d+a,a,270*b,360*b,!1),this.lineTo(e,f-a),this.arc(e-a,f-a,a,0*b,90*b,!1),this.lineTo(c+a,f),this.arc(c+a,f-a,a,90*b,180*b,!1),this.lineTo(c,d+a),this.arc(c+a,d+a,a,180*b,270*b,!1),this.closePath()}