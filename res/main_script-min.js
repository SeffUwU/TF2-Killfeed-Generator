const[BLUE_TEAM_CLR,RED_TEAM_CLR]=["#557C83","#A3574A"];let df;function get_icon_list(){var t=Object.keys(iconList).length;console.log(`Icon amount: ${t}`);for(var a=1;a<t+1;a++){var e=Object.keys(iconList[`${a}`]),i=iconList[a][e];$(".killicon-container").append(`<div class='list-item ${i}' data-fname="${e}">\n        <img class="selectable-img " src="icons_sorted/${e}" data-fname="${e}" alt='${e.toString().slice(0,-4).replace("_"," ")}'>\n       </div>`)}}async function color_switch(){df.attr("data-colors",0==df.attr("data-colors")?1:0);const[t,a]=returnTeamColorTuple();$(".clr-show-l").css("background",t),$(".clr-show-r").css("background",a),df.attr("data-custom-pos")?draw_kill(2):draw_kill()}function returnTeamColorTuple(){return 1==df.attr("data-teamkill")?0==df.attr("data-colors")?[RED_TEAM_CLR,RED_TEAM_CLR]:[BLUE_TEAM_CLR,BLUE_TEAM_CLR]:0==df.attr("data-colors")?[RED_TEAM_CLR,BLUE_TEAM_CLR]:[BLUE_TEAM_CLR,RED_TEAM_CLR]}function draw_kill(t){if(!df)return;const a=document.getElementById("display-feed"),[e,i]=[a.width,a.height],c=a.getContext("2d"),o=parseInt(df.attr("data-custom-pos"))||0,s=new Image,n=df.attr("data-is-ks")>0,d=new Image,l=new Image;l.origin="anonymous",d.origin="anonymous";const r=df.attr("data-icon-name"),h=df.attr("data-special-bg"),[f,p]=[$("#KILLER").val(),$("#VICTIM").val()],[m,u]=returnTeamColorTuple(),g=$("#is_init").prop("checked")?"#3e3923":"#F1E9CB",_={0:"unused",1:"is DOMINATING",2:$("#custom_special").val(),3:"fell to a clumsy, painful death"}[t]||"";"0"!=h&&(l.src="1"==h?"icons_sorted/Killicon_crit.png":"icons_sorted/Killicon_australium.png"),n&&(s.src=$("#is_init").prop("checked")?"icons_sorted/Killstreak_Icon.png":"icons_sorted/Killstreak_Icon02.png"),d.onload=function(){c.clearRect(0,0,e,i),c.font="bold 125% Verdana";const a=1.52,d=3==t?0:c.measureText(f).width,r=c.measureText(p).width,k=_?c.measureText(_).width:0,w=$("#is_drawIcon").prop("checked")?this.width*a:0;c.font="bold 20px Verdana";const T=df.attr("data-is-ks"),E=n?c.measureText(T).width+5:0,I=n?25:0,b=w+E+I;c.font="bold 125% Verdana";const v=[{id:"killer",w:d,active:3!=t},{id:"icon",w:b,active:!0},{id:"victim",w:r,active:!0}];_&&(df.attr("data-custom-pos")?v.splice(o,0,{id:"text",w:k,active:!0}):3===t&&v.splice(3,0,{id:"text",w:k,active:!0}));const C=v.filter((t=>t.active&&t.w>0)),x=C.reduce(((t,a)=>t+a.w),0)+15*(C.length+1)+20;$("#save").attr("data-img-width",Math.ceil(x));const y=e/2-x/2,L=$("#is_init").prop("checked")?"#E2CDB2":"#202020"+($("#transparent_bg").prop("checked")?"c8":"");c.roundRect(y,20,y+x,i,6),c.fillStyle=L,c.fill();let R=y+15+10;C.forEach((o=>{if("killer"===o.id)c.fillStyle=m,c.fillText(f,R,58);else if("text"===o.id)c.fillStyle=g,c.fillText(_,R,58);else if("victim"===o.id)c.fillStyle=u,c.fillText(p,R,58);else if("icon"===o.id){const o=R,d=o+E+I,r=this.height,f=i/2-r/2+9-r/4;if("0"!=h&&l.complete){const t=2.3200000000000003;c.globalAlpha=.85,c.drawImage(l,d+w/2-l.width*t/2,i/6,l.width*t,l.height*t),c.globalAlpha=1}n&&(c.font="bold 20px Verdana",c.fillStyle=$("#is_init").prop("checked")?"#202020":"#f1e9cb",c.fillText(T,o,58),c.drawImage(s,o+E,i/2,s.width/1.7,s.height/1.7),c.font="bold 125% Verdana"),$("#is_drawIcon").prop("checked")&&(c.drawImage(this,d,f,this.width*a,r*a),applyIconMask(c,this,d,f,a,t,e,i))}R+=o.w+15}))},d.src=1==t?"icons_sorted/Killicon_domination.png":3==t?"icons_sorted/Killicon_skull.png":$(`img[data-fname='${r}']`).attr("src")}function applyIconMask(t,a,e,i,c,o,s,n){if($("#is_init").prop("checked")&&1!=o)return;const d=a.width,l=a.height;let r=1==o?masked_image(a,245,229,193,255,10,d,l,c):masked_image(a,64,60,36,255,55,d,l,c);const h=document.createElement("canvas"),f=h.getContext("2d");h.width=s,h.height=n,f.drawImage(a,e,i,d*c,l*c),f.globalCompositeOperation="source-in",f.drawImage(r,e,i),t.drawImage(h,0,0)}function save(){const t=$("#save").attr("data-img-width"),a=document.getElementById("display-feed"),e=a.width/2-t/2,i=document.createElement("canvas");i.width=t,i.height=80,tctx=i.getContext("2d"),tctx.drawImage(a,e,0,t,80,0,-10,t,80);const c=document.createElement("a");c.download="killfeed_generated.png",c.href=i.toDataURL(),c.click(),c.delete}function masked_image(t,a,e,i,c,o,s,n,d=1){let l=document.createElement("canvas");l.width=s*d,l.height=n*d,ctx=l.getContext("2d"),ctx.drawImage(t,0,0,s*d,n*d);for(var r=ctx.getImageData(0,0,l.width,l.height),h=r.data,f=0;f<h.length;f+=4){var p=h[f+0]>a-o&&h[f+0]<a+o&&h[f+1]>e-o&&h[f+1]<e+o&&h[f+2]>i-o&&h[f+2]<i+o&&h[f+3]>0;h[f+0]=p?241:0,h[f+1]=p?233:0,h[f+2]=p?203:0,h[f+3]=p?255:0}return ctx.putImageData(r,0,0),l}$(document).ready((function(){let t=[];$(".sortable").on("click",(function(){const a=$(this).attr("data-tags");$(".list-item").css("display",""),"off"==$(this).attr("data-sort")?(t=t.filter((t=>t!==`.${a}`)),$(this).attr("data-sort","on")):(t.push(`.${a}`),$(this).attr("data-sort","off")),$(t.join(",")).css("display","none")})),$("#deselect-all").click((function(){const t=$(".sortable");t.attr("data-sort","on"),t.click()})),df=$("#display-feed"),$("#is_killstreak").on("input",(()=>{let t=$("#is_killstreak").val();$("#display-feed").attr("data-is-ks",t>=0?t:0)})),$("#is_crit").change((function(){if(this.checked)return df.attr("data-special-bg",1),$("#is_aussie").prop("checked",!1);df.attr("data-special-bg",0)})),$("#is_aussie").change((function(){if(this.checked)return df.attr("data-special-bg",2),$("#is_crit").prop("checked",!1);df.attr("data-special-bg",0)})),$("#is_teamkill").change((function(){if(this.checked)return df.attr("data-teamkill",1),color_switch(),$("#is_crit").prop("checked",!1);df.attr("data-teamkill",0),color_switch()})),$(document).on("click",".list-item",(function(){const t=$(this).attr("data-fname");$(".list-item").removeClass("selected"),$(this).addClass("selected"),$("#display-feed").attr("data-icon-name",`${t}`),df.attr("data-custom-pos")?draw_kill(2):draw_kill()})),$(".option-checkbox").change((function(){$("#is_init").prop("checked")?$("#transparent_bg").attr("disabled",!0):$("#transparent_bg").attr("disabled",!1),df.attr("data-custom-pos")?draw_kill(2):draw_kill()})),$("#KILLER, #VICTIM, #is_killstreak, #custom_special").on("input",(()=>{df.attr("data-custom-pos")?draw_kill(2):$("#updateOnChange").prop("checked")&&draw_kill()})),$(".custom-text-selector-button").on("click",(function(){const t=$(this).attr("data-idx");console.log("CUSTOM",df.attr("data-custom-pos"),t),$(".custom-text-selector-button").removeAttr("style"),df.attr("data-custom-pos")==t?df.attr("data-custom-pos",null):(df.attr("data-custom-pos",t),$(this).css({"background-color":"#F1E9CB"})),draw_kill(2)})),draw_kill()})),CanvasRenderingContext2D.prototype.roundRect=function(t,a,e,i,c){var o=Math.PI/180;e-t-2*c<0&&(c=(e-t)/2),i-a-2*c<0&&(c=(i-a)/2),this.beginPath(),this.moveTo(t+c,a),this.lineTo(e-c,a),this.arc(e-c,a+c,c,270*o,360*o,!1),this.lineTo(e,i-c),this.arc(e-c,i-c,c,0*o,90*o,!1),this.lineTo(t+c,i),this.arc(t+c,i-c,c,90*o,180*o,!1),this.lineTo(t,a+c),this.arc(t+c,a+c,c,180*o,270*o,!1),this.closePath()};