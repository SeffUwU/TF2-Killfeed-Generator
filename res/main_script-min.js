const[BLUE_TEAM_CLR,RED_TEAM_CLR]=["#557C83","#A3574A"];let df;function get_icon_list(){var t=Object.keys(iconList).length;console.log(`Icon amount: ${t}`);for(var e=1;e<t+1;e++){var a=Object.keys(iconList[`${e}`]),i=iconList[e][a];$(".killicon-container").append(`<div class='list-item ${i}' data-fname="${a}">\n        <img class="selectable-img " src="icons_sorted/${a}" data-fname="${a}" alt='${a.toString().slice(0,-4).replace("_"," ")}'>\n       </div>`)}}async function color_switch(){df.attr("data-colors",0==df.attr("data-colors")?1:0);const[t,e]=returnTeamColorTuple();$(".clr-show-l").css("background",t),$(".clr-show-r").css("background",e),df.attr("data-custom-pos")?draw_kill(2):draw_kill()}function returnTeamColorTuple(){return 1==df.attr("data-teamkill")?0==df.attr("data-colors")?[RED_TEAM_CLR,RED_TEAM_CLR]:[BLUE_TEAM_CLR,BLUE_TEAM_CLR]:0==df.attr("data-colors")?[RED_TEAM_CLR,BLUE_TEAM_CLR]:[BLUE_TEAM_CLR,RED_TEAM_CLR]}function draw_kill(t){if(!df)return;const e=document.getElementById("display-feed"),[a,i]=[e.width,e.height],c=e.getContext("2d"),s=parseInt(df.attr("data-custom-pos"))||0,o=new Image,n=df.attr("data-is-ks")>0,l=new Image,d=new Image;d.origin="anonymous",l.origin="anonymous";const r=df.attr("data-icon-name"),h=df.attr("data-special-bg"),[f,p]=[$("#KILLER").val(),$("#VICTIM").val()],[m,u]=returnTeamColorTuple(),g=$("#is_init").prop("checked")?"#3e3923":"#F1E9CB",_={0:"unused",1:"is DOMINATING",2:$("#custom_special").val(),3:"fell to a clumsy, painful death"}[t]||"";"0"!=h&&(d.src="1"==h?"icons_sorted/Killicon_crit.png":"icons_sorted/Killicon_australium.png"),n&&(o.src=$("#is_init").prop("checked")?"icons_sorted/Killstreak_Icon.png":"icons_sorted/Killstreak_Icon02.png"),l.onload=function(){c.clearRect(0,0,a,i),c.font="bold 125% Verdana";const e=1.52,l=3==t?0:c.measureText(f).width,r=c.measureText(p).width,k=_?c.measureText(_).width:0,w=$("#is_drawIcon").prop("checked")?this.width*e:0;c.font="bold 20px Verdana";const T=df.attr("data-is-ks"),E=n?c.measureText(T).width+5:0,I=n?25:0,b=w+E+I;c.font="bold 125% Verdana";const v=[{id:"killer",w:l,active:3!=t},{id:"icon",w:b,active:!0},{id:"victim",w:r,active:!0}];_&&(1==t?v.splice(2,0,{id:"text",w:k,active:!0}):3===t?v.splice(3,0,{id:"text",w:k,active:!0}):df.attr("data-custom-pos")&&v.splice(s,0,{id:"text",w:k,active:!0}));const C=v.filter((t=>t.active&&t.w>0)),x=C.reduce(((t,e)=>t+e.w),0)+15*(C.length+1)+20;$("#save").attr("data-img-width",Math.ceil(x));const y=a/2-x/2,L=$("#is_init").prop("checked")?"#E2CDB2":"#202020"+($("#transparent_bg").prop("checked")?"c8":"");c.roundRect(y,20,y+x,i,6),c.fillStyle=L,c.fill();let R=y+15+10;C.forEach((s=>{if("killer"===s.id)c.fillStyle=m,c.fillText(f,R,58);else if("text"===s.id)c.fillStyle=g,c.fillText(_,R,58);else if("victim"===s.id)c.fillStyle=u,c.fillText(p,R,58);else if("icon"===s.id){const s=R,l=s+E+I,r=this.height,f=i/2-r/2+9-r/4;if("0"!=h&&d.complete){const t=2.3200000000000003;c.globalAlpha=.85,c.drawImage(d,l+w/2-d.width*t/2,i/6,d.width*t,d.height*t),c.globalAlpha=1}n&&(c.font="bold 20px Verdana",c.fillStyle=$("#is_init").prop("checked")?"#202020":"#f1e9cb",c.fillText(T,s,58),c.drawImage(o,s+E,i/2,o.width/1.7,o.height/1.7),c.font="bold 125% Verdana"),$("#is_drawIcon").prop("checked")&&(c.drawImage(this,l,f,this.width*e,r*e),applyIconMask(c,this,l,f,e,t,a,i))}R+=s.w+15}))},l.src=1==t?"icons_sorted/Killicon_domination.png":3==t?"icons_sorted/Killicon_skull.png":$(`img[data-fname='${r}']`).attr("src")}function applyIconMask(t,e,a,i,c,s,o,n){if($("#is_init").prop("checked")&&1!=s)return;const l=e.width,d=e.height;let r=1==s?masked_image(e,245,229,193,255,10,l,d,c):masked_image(e,64,60,36,255,55,l,d,c);const h=document.createElement("canvas"),f=h.getContext("2d");h.width=o,h.height=n,f.drawImage(e,a,i,l*c,d*c),f.globalCompositeOperation="source-in",f.drawImage(r,a,i),t.drawImage(h,0,0)}function save(){const t=$("#save").attr("data-img-width"),e=document.getElementById("display-feed"),a=e.width/2-t/2,i=document.createElement("canvas");i.width=t,i.height=80,tctx=i.getContext("2d"),tctx.drawImage(e,a,0,t,80,0,-10,t,80);const c=document.createElement("a");c.download="killfeed_generated.png",c.href=i.toDataURL(),c.click(),c.delete}function masked_image(t,e,a,i,c,s,o,n,l=1){let d=document.createElement("canvas");d.width=o*l,d.height=n*l,ctx=d.getContext("2d"),ctx.drawImage(t,0,0,o*l,n*l);for(var r=ctx.getImageData(0,0,d.width,d.height),h=r.data,f=0;f<h.length;f+=4){var p=h[f+0]>e-s&&h[f+0]<e+s&&h[f+1]>a-s&&h[f+1]<a+s&&h[f+2]>i-s&&h[f+2]<i+s&&h[f+3]>0;h[f+0]=p?241:0,h[f+1]=p?233:0,h[f+2]=p?203:0,h[f+3]=p?255:0}return ctx.putImageData(r,0,0),d}$(document).ready((function(){let t=[];$(".sortable").on("click",(function(){const e=$(this).attr("data-tags");$(".list-item").css("display",""),"off"==$(this).attr("data-sort")?(t=t.filter((t=>t!==`.${e}`)),$(this).attr("data-sort","on")):(t.push(`.${e}`),$(this).attr("data-sort","off")),$(t.join(",")).css("display","none")})),$("#deselect-all").click((function(){$(".sortable").click()})),df=$("#display-feed"),$("#is_killstreak").on("input",(()=>{let t=$("#is_killstreak").val();$("#display-feed").attr("data-is-ks",t>=0?t:0)})),$("#is_crit").change((function(){if(this.checked)return df.attr("data-special-bg",1),$("#is_aussie").prop("checked",!1);df.attr("data-special-bg",0)})),$("#is_aussie").change((function(){if(this.checked)return df.attr("data-special-bg",2),$("#is_crit").prop("checked",!1);df.attr("data-special-bg",0)})),$("#is_teamkill").change((function(){if(this.checked)return df.attr("data-teamkill",1),color_switch(),$("#is_crit").prop("checked",!1);df.attr("data-teamkill",0),color_switch()})),$(document).on("click",".list-item",(function(){const t=$(this).attr("data-fname");$(".list-item").removeClass("selected"),$(this).addClass("selected"),$("#display-feed").attr("data-icon-name",`${t}`),df.attr("data-custom-pos")?draw_kill(2):draw_kill()})),$(".option-checkbox").change((function(){$("#is_init").prop("checked")?$("#transparent_bg").attr("disabled",!0):$("#transparent_bg").attr("disabled",!1),df.attr("data-custom-pos")?draw_kill(2):draw_kill()})),$("#KILLER, #VICTIM, #is_killstreak, #custom_special").on("input",(()=>{df.attr("data-custom-pos")?draw_kill(2):$("#updateOnChange").prop("checked")&&draw_kill()})),$(".custom-text-selector-button").on("click",(function(){const t=$(this).attr("data-idx");console.log("CUSTOM",df.attr("data-custom-pos"),t),$(".custom-text-selector-button").removeAttr("style"),df.attr("data-custom-pos")==t?df.attr("data-custom-pos",null):(df.attr("data-custom-pos",t),$(this).css({"background-color":"#F1E9CB"})),draw_kill(2)})),draw_kill()})),CanvasRenderingContext2D.prototype.roundRect=function(t,e,a,i,c){var s=Math.PI/180;a-t-2*c<0&&(c=(a-t)/2),i-e-2*c<0&&(c=(i-e)/2),this.beginPath(),this.moveTo(t+c,e),this.lineTo(a-c,e),this.arc(a-c,e+c,c,270*s,360*s,!1),this.lineTo(a,i-c),this.arc(a-c,i-c,c,0*s,90*s,!1),this.lineTo(t+c,i),this.arc(t+c,i-c,c,90*s,180*s,!1),this.lineTo(t,e+c),this.arc(t+c,e+c,c,180*s,270*s,!1),this.closePath()};